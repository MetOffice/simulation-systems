

<!DOCTYPE html>


<html lang="en" data-content_root="" data-theme="auto">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>How To Commit &#8212; Simulation Systems  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "auto";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "auto";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Reviewers/howtocommit';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Committing Linked Tickets" href="committinglinkedtickets.html" />
    <link rel="prev" title="Code and System Review" href="codereview.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="auto">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/MO_SQUARE_black_mono_for_light_backg_RBG.png" class="logo__image only-light" alt=""/>
    <script>document.write(`<img src="../_static/MO_SQUARE_for_dark_backg_RBG.png" class="logo__image only-dark" alt=""/>`);</script>
  
  
    <p class="title logo__title">Simulation Systems</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="../WorkingPractices/working_practices.html">
    Working Practices
  </a>
</li>


<li class="nav-item pst-header-nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Guides for Reviewers
  </a>
</li>


<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="../FurtherDetails/index.html">
    Further Details
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/MetOffice/simulation-systems/discussions" title="GitHub Discussions" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="far fa-comments fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub Discussions</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <button class="sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="../WorkingPractices/working_practices.html">
    Working Practices
  </a>
</li>


<li class="nav-item pst-header-nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Guides for Reviewers
  </a>
</li>


<li class="nav-item pst-header-nav-item">
  <a class="nav-link nav-internal" href="../FurtherDetails/index.html">
    Further Details
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/MetOffice/simulation-systems/discussions" title="GitHub Discussions" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="far fa-comments fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub Discussions</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Guides for Reviewers</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="scitechreview.html">Science and Technical Review</a></li>
<li class="toctree-l1"><a class="reference internal" href="codereview.html">Code and System Review</a></li>
<li class="toctree-l1 current active has-children"><a class="current reference internal" href="#">How To Commit</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="committinglinkedtickets.html">Committing Linked Tickets</a></li>
<li class="toctree-l2"><a class="reference internal" href="nightlytesting.html">Nightly Testing</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="curaterelease.html">Curating a Release</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Guides for Reviewers</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">How To Commit</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="how-to-commit">
<span id="howtocommit"></span><h1>How To Commit<a class="headerlink" href="#how-to-commit" title="Permalink to this heading">#</a></h1>
<p>The process for committing a ticket follows this sequence with details for each of these steps outlined below.</p>
<img alt="../_images/commit_process.png" class="dark-light" src="../_images/commit_process.png" />
<div class="admonition important">
<p class="admonition-title">Important</p>
<dl class="simple">
<dt>Before You Start:</dt><dd><ul class="simple">
<li><p>Is anyone else committing?</p>
<ul>
<li><p><a class="reference external" href="https://code.metoffice.gov.uk/trac/um/wiki/TrunkStatus">Trunk Status</a> is used to coordinate trunk commits for UM, JULES, LFRic Apps and UKCA.</p></li>
<li><p>LFRic Core Trunk commits are coordinated through the dashboard in the Model Systems Teams Chat.</p></li>
<li><p>Simple, not conflicting commits can be done in parallel if reviewers all agree.</p></li>
<li><p>Changes with KGO or Macros usually require sole access to the trunk.</p></li>
</ul>
</li>
<li><p>Check how many commits have happened today. Suggested limit per day, per repository is 4.</p>
<ul>
<li><p>More than 4 can be committed if <cite>all</cite> groups have been run by a team member.</p></li>
</ul>
</li>
</ul>
</dd>
</dl>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p><strong>Linked Tickets?</strong></p>
<p>If this is a set of linked tickets then the commit process will need to be
followed for each repository in parallel. See <a class="reference internal" href="committinglinkedtickets.html#committinglinkedtickets"><span class="std std-ref">Committing Linked Tickets</span></a>
for more details of how this works.</p>
<div class="toctree-wrapper compound">
</div>
</div>
<section id="merge">
<h2>1. Merge<a class="headerlink" href="#merge" title="Permalink to this heading">#</a></h2>
<p>Check out the trunk, merge the changes from the branch into that trunk copy and
resolve any conflicts.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-0" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-0">
UM</label><div class="sd-tab-content docutils">
<div class="highlight-RST notranslate"><div class="highlight"><pre><span></span>fcm co fcm:um.x_tr chosen_name
cd chosen_name
fcm merge fcm:um.x_br/dev/dev_name/branch_name
fcm cf
</pre></div>
</div>
</div>
<input id="sd-tab-item-1" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-1">
JULES</label><div class="sd-tab-content docutils">
<div class="highlight-RST notranslate"><div class="highlight"><pre><span></span>fcm co fcm:jules.x_tr chosen_name
cd chosen_name
fcm merge fcm:jules.x_br/dev/dev_name/branch_name
fcm cf
</pre></div>
</div>
</div>
<input id="sd-tab-item-2" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-2">
UKCA</label><div class="sd-tab-content docutils">
<div class="highlight-RST notranslate"><div class="highlight"><pre><span></span>fcm co fcm:ukca.x_tr chosen_name
cd chosen_name
fcm merge fcm:ukca.x_br/dev/dev_name/branch_name
fcm cf
</pre></div>
</div>
</div>
<input id="sd-tab-item-3" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-3">
LFRic Apps</label><div class="sd-tab-content docutils">
<div class="highlight-RST notranslate"><div class="highlight"><pre><span></span>fcm co fcm:lfric_apps.x_tr chosen_name
cd chosen_name
fcm merge fcm:lfric_apps.x_br/dev/dev_name/branch_name
fcm cf
</pre></div>
</div>
</div>
<input id="sd-tab-item-4" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-4">
LFRic Core</label><div class="sd-tab-content docutils">
<div class="highlight-RST notranslate"><div class="highlight"><pre><span></span>fcm co fcm:lfric.x_tr chosen_name
cd chosen_name
fcm merge fcm:lfric.x_br/dev/dev_name/branch_name
fcm cf
</pre></div>
</div>
</div>
<input id="sd-tab-item-5" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-5">
UM docs</label><div class="sd-tab-content docutils">
<div class="highlight-RST notranslate"><div class="highlight"><pre><span></span>fcm co fcm:um_doc.x_tr chosen_name
cd chosen_name
fcm merge fcm:um_doc.x_br/dev/dev_name/branch_name
fcm cf
</pre></div>
</div>
</div>
<input id="sd-tab-item-6" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-6">
JULES docs</label><div class="sd-tab-content docutils">
<p>See <a class="reference internal" href="../WorkingPractices/jules_docs.html"><span class="doc">JULES documentation changes</span></a></p>
</div>
</div>
<p>Always merge in the developers <strong>dev</strong> branch, not the <strong>test</strong> branch.</p>
<p>Only resolve <a class="reference external" href="http://metomi.github.io/fcm/doc/user_guide/code_management.html#svn_basic_conflicts">conflicts</a>
that appear simple and you are comfortable with. If there are more complicated
conflicts ask the developer to create a head of trunk branch to resolve the
conflicts themselves and retest the changes.</p>
<p>If there are conflicts in versions.py then see the details in the macro section below.</p>
</section>
<section id="macros-if-required">
<h2>2. Macros (if required)<a class="headerlink" href="#macros-if-required" title="Permalink to this heading">#</a></h2>
<p><strong>If</strong> the ticket includes metadata changes, upgrade macro changes or a new rose-stem app
then you will need to upgrade the test-suite.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
versions.py<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">versions.py contains a sequence of upgrade macros. Each macro contains a
<cite>BEFORE_TAG</cite> and an <cite>AFTER_TAG</cite> which should create a single chain, starting
at the last release and finishing with the ticket you are committing. The
tags have the format version_ticket, i.e. <cite>vnXX.Y_tZZZZ</cite>.</p>
<p class="sd-card-text">When resolving conflicts in this file make sure that the new macro being added
by your ticket is added to the end of the file. Modify the <cite>BEFORE_TAG</cite> to
match the <cite>AFTER_TAG</cite> of the previous macro in the chain.</p>
<p class="sd-card-text">If this is the first macro since the release then the <cite>BEFORE_TAG</cite> will be
the version number with no added ticket number.</p>
<p class="sd-card-text">Remove the template macro if it is still present.</p>
</div>
</details><details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Applying Macros<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">To update the test suite for an upgrade macro, please run:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-7" name="sd-tab-set-1" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-7">
UM</label><div class="sd-tab-content docutils">
<div class="highlight-RST notranslate"><div class="highlight"><pre><span></span>~frum/bin/update_all.py --path=/path/to/working/copy/of/trunk --um=vnXX.Y_tZZZZ [--jules-path=/path/to/working/copy/of/jules/trunk]
</pre></div>
</div>
<p class="sd-card-text">where <cite>--um=vnXX.Y_tZZZZ</cite> is the <cite>AFTER_TAG</cite> of the latest
upgrade macro.</p>
<p class="sd-card-text">If there is a macro for fcm_make or createbc then check that the makes <cite>version*_*.py</cite> has the
correct BEFORE and AFTER tags and append <cite>--makeum=vnXX.Y_tZZZZ</cite> and/or <cite>--createbc=vnXX.Y_tZZZZ</cite>
to the above command.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p class="sd-card-text">Please ensure that Cylc7 is used with <cite>update_all.py</cite> &#64;vn13.5.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p class="sd-card-text">The <cite>--jules-path</cite> option is only required if there
are linked <a class="reference external" href="https://code.metoffice.gov.uk/trac/jules/browser/main/trunk/rose-meta/jules-shared">jules-shared</a>
metadata changes.</p>
</div>
</div>
<input id="sd-tab-item-8" name="sd-tab-set-1" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-8">
JULES</label><div class="sd-tab-content docutils">
<div class="highlight-RST notranslate"><div class="highlight"><pre><span></span>./bin/upgrade_jules_test_apps vnX.Y_tZZZZ
</pre></div>
</div>
<p class="sd-card-text">where <cite>vnX.Y_tZZZZ</cite> is the <cite>AFTER_TAG</cite> of the latest upgrade macro.
The upgrade is expected to fail for the <cite>fab_jules</cite>, <cite>metadata_checker</cite> and <cite>umdp3_checker</cite> apps.</p>
</div>
</div>
</div>
</details><details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
New rose-stem app?<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">If the ticket introduces a new rose-stem app, but doesn’t otherwise have a macro
then that app will need to be updated to match the metadata at the Head Of Trunk.</p>
<ol class="arabic">
<li><p class="sd-card-text">In the new app directory get a list of all available upgrade points by running</p>
<blockquote>
<div><div class="highlight-RST notranslate"><div class="highlight"><pre><span></span>rose app-upgrade -a -y -M path/to/working_copy/rose-meta
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="sd-card-text">Select the latest upgrade point from the list provided and then run the command again, adding this to the end</p>
<blockquote>
<div><div class="highlight-RST notranslate"><div class="highlight"><pre><span></span>rose app-upgrade -a -y -M path/to/working_copy/rose-meta vnX.Y_tZZZZ
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<p class="sd-card-text">The app should now be updated to the same metadata version as the rest of the apps on the Trunk.
This can be checked with:</p>
<blockquote>
<div><div class="highlight-RST notranslate"><div class="highlight"><pre><span></span>rose macro --validate -M path/to/working_copy/rose-meta
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p class="sd-card-text">For UM tickets, if there are linked <a class="reference external" href="https://code.metoffice.gov.uk/trac/jules/browser/main/trunk/rose-meta/jules-shared">jules-shared</a>
metadata changes these will need to be added to the metadata
path. Please see the <a class="reference internal" href="../WorkingPractices/metadata_guidance.html#metadata-changes"><span class="std std-ref">rose config-edit
example</span></a>.</p>
</div>
</div>
</details><details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Temporary Logical?<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">If a new temporary logical has been added, or an old one retired, then
update the <a class="reference external" href="https://code.metoffice.gov.uk/trac/um/wiki/TempUMlogicals">table that lists them</a>.</p>
</div>
</details></section>
<section id="test-if-no-kgo">
<h2>3. Test (if no KGO)<a class="headerlink" href="#test-if-no-kgo" title="Permalink to this heading">#</a></h2>
<p>The amount of testing to be done at this stage depends on the complexity
of the ticket, and what has already been done. A minimum level is required for
even trivial tickets to check that the merge has not caused issues, or that there
are no clashes with what else has gone on trunk.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Linked tickets will need to be tested together as discussed <a class="reference internal" href="committinglinkedtickets.html#tesinglinked"><span class="std std-ref">here</span></a>.</p>
</div>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-9" name="sd-tab-set-2" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-9">
UM</label><div class="sd-tab-content docutils">
<p>Run any necessary testing; at the very least run a compile group,
generally run developer, and more complex tickets warrant running everything:</p>
<div class="highlight-RST notranslate"><div class="highlight"><pre><span></span>rose stem --group=debug_compile
OR rose stem --group=developer,ex1a_developer
OR rose stem --group=all,ex1a
</pre></div>
</div>
<p>If there is a change to the build configs then you may need to turn off
prebuilds. To do so update <cite>rose-stem/site/meto/variables.rc</cite> such that</p>
<div class="highlight-RST notranslate"><div class="highlight"><pre><span></span>{% do SITE_VARS.update({&quot;PREBUILDS&quot; : false}) %}
</pre></div>
</div>
</div>
<input id="sd-tab-item-10" name="sd-tab-set-2" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-10">
JULES</label><div class="sd-tab-content docutils">
<p>The JULES test suite is quick to run, so it’s usual to test <cite>all</cite> for any ticket.
If you have the appropriate environment setup then include the <cite>fab</cite> group too.</p>
<div class="highlight-RST notranslate"><div class="highlight"><pre><span></span>rose stem --group=all,fab
</pre></div>
</div>
</div>
<input id="sd-tab-item-11" name="sd-tab-set-2" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-11">
UKCA</label><div class="sd-tab-content docutils">
<p>The UKCA rose-stem contains minimal tests at the moment, but should be run to
confirm the style checker passes.</p>
<div class="highlight-RST notranslate"><div class="highlight"><pre><span></span>rose stem --group=all
</pre></div>
</div>
<p>UKCA testing should also be carried out using the UM rose stem. Check
out the UM trunk, and then run</p>
<div class="highlight-RST notranslate"><div class="highlight"><pre><span></span>rose stem --group=developer,ukca --source=. --source=/path/to/UKCA/working/copy
</pre></div>
</div>
</div>
<input id="sd-tab-item-12" name="sd-tab-set-2" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-12">
LFRic Apps</label><div class="sd-tab-content docutils">
<p>LFRic Apps rose-stem contains tests spanning all the applications
included in the repository. At the very least run the developer group
which gives a basic level of tests spanning everything. The full set of
tests may be warranted for any application that has had more complex changes.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">CYLC_VERSION</span><span class="o">=</span><span class="mi">8</span>

<span class="n">rose</span> <span class="n">stem</span> <span class="o">--</span><span class="n">group</span><span class="o">=</span><span class="n">developer</span>
<span class="n">OR</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">rose</span> <span class="n">stem</span> <span class="o">--</span><span class="n">group</span><span class="o">=</span><span class="n">developer</span><span class="p">,</span><span class="n">gungho_model</span>

<span class="n">cylc</span> <span class="n">play</span> <span class="o">&lt;</span><span class="n">working</span> <span class="n">copy</span> <span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-13" name="sd-tab-set-2" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-13">
LFRic Core</label><div class="sd-tab-content docutils">
<p>Run the test suite command from the top level of the repository to run
a complete set of the rose-stem developer suites.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">test</span><span class="o">-</span><span class="n">suite</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-14" name="sd-tab-set-2" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-14">
UM docs</label><div class="sd-tab-content docutils">
<p>Check the documentation builds correctly:</p>
<div class="highlight-RST notranslate"><div class="highlight"><pre><span></span>./build_umdoc.py [XXX YYY etc]
</pre></div>
</div>
<p>where XXX YYY are the details of which docs require building.</p>
</div>
<input id="sd-tab-item-15" name="sd-tab-set-2" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-15">
JULES docs</label><div class="sd-tab-content docutils">
<p>JULES documentation is hosted within the <a class="reference external" href="https://github.com/jules-lsm/jules-lsm.github.io">JULES GitHub repository</a>.
To review and build the documentation branch locally, move to your
local clone of the JULES GitHub, then:</p>
<div class="highlight-RST notranslate"><div class="highlight"><pre><span></span>git pull
git checkout &lt;branch name&gt;
cd &lt;path_to&gt;/user_guide/doc
conda activate jules-user-guide
make html
firefox build/html/index.html
</pre></div>
</div>
<p>To build and check the LaTeX PDF:</p>
<div class="highlight-RST notranslate"><div class="highlight"><pre><span></span>make latexpdf
evince build/latex/JULES_User_Guide.pdf
</pre></div>
</div>
</div>
</div>
</section>
<section id="kgo-if-required">
<h2>4. KGO (if required)<a class="headerlink" href="#kgo-if-required" title="Permalink to this heading">#</a></h2>
<p><strong>If</strong> your change is known to alter answers, you need to update rose-stem KGO
for all affected tests before you commit to the trunk.</p>
<p><em>NB: These instructions are Met Office specific, other sites may manage their KGO differently</em></p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Setup for first KGO install (UM + LFRic Inputs)<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">If doing a UM or LFRic Inputs KGO, before you start the process below there is a one-time setup step required to
allow you to generate KGO using the update script.</p>
<p class="sd-card-text">Edit <cite>~/.metomi/rose.conf</cite> on <em>all platforms</em> - Desktop, XCE/F, XCS and EXZ
to contain the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">rose</span><span class="o">-</span><span class="n">ana</span><span class="p">]</span>
<span class="n">kgo</span><span class="o">-</span><span class="n">database</span><span class="o">=.</span><span class="n">true</span><span class="o">.</span>
</pre></div>
</div>
</div>
</details><div class="sd-tab-set docutils" id="kgo-instructions">
<input checked="checked" id="sd-tab-item-16" name="sd-tab-set-3" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-16">
UM + LFRic Inputs</label><div class="sd-tab-content docutils">
<p>KGO files are stored in <cite>$UMDIR/standard_jobs/kgo</cite> or <cite>$UMDIR/standard_jobs/lfricinputs/kgo</cite> and are installed there
using a script.</p>
<ol class="arabic simple">
<li><p>Run the rose stem tasks that require a KGO update, plus any other testing required (see above) - if unsure run the <cite>all,ex1a</cite>.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rose</span> <span class="n">stem</span> <span class="o">--</span><span class="n">group</span><span class="o">=</span><span class="nb">all</span><span class="p">,</span><span class="n">ex1a</span> <span class="o">--</span><span class="n">new</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>You will need access to both your merged working copy and a clone of the <a class="reference external" href="https://github.com/MetOffice/SimSys_Scripts">SimSys_Scripts github repo</a> (one is available in $UMDIR). Run the script <code class="docutils literal notranslate"><span class="pre">kgo_updates/meto_update_kgo.sh</span></code> which is located in SimSys_Scripts.</p></li>
<li><dl class="simple">
<dt>The script will ask you to enter some details regarding the ticket.</dt><dd><ul class="simple">
<li><p>Platforms: enter each platform which has a kgo change, lower case and space seperated, e.g. <cite>spice xc40 ex1a</cite></p></li>
<li><p>Path to your merged working copy - the script will check this exists and will fail if it can’t be found.</p></li>
<li><p>KGO directory: this will default to vnXX.X_tYYYY where XX.X is the version number and YYYY is the ticket number.</p></li>
<li><p>There are further prompts to the user through the script - in particular to check the shell script produced.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>If running on xc40s the script will ask whether to rsync UM files or lfricinputs files to the XCS. Select the appropriate option.</p></li>
<li><p>Check that the new KGO has been installed correctly by restarting your suite, retriggering the failed rose-ana tasks and checking they now pass.</p></li>
</ol>
<ul class="simple">
<li><p>e.g. add <cite>–reload</cite> or <cite>–restart</cite> to the rose-stem command ran previously.</p></li>
</ul>
<ol class="arabic simple" start="6">
<li><p>Once committed, update the <a class="reference external" href="https://code.metoffice.gov.uk/trac/um/wiki/LoseBitComparison">bit comparison table</a>.</p></li>
</ol>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
More details on KGO update script<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<ul class="simple">
<li><p class="sd-card-text">This script will login as <cite>frum</cite> and <cite>umadmin</cite> as needed</p></li>
<li><p class="sd-card-text">After running for a platform, the newly created variables.rc and
shell script will be moved to SPICE ~frum/kgo_update_files/&lt;new_kgo_directory&gt;.</p></li>
<li><p class="sd-card-text">The script is hard coded to always go to the xce (only 1 is
required of xce and xcf). After running here it will rsync the kgo
directory to xcs automatically.</p></li>
<li><p class="sd-card-text">Having run on each requested platform the new variables.rc files
will be copied into your working copy
rose-stem/site/meto/variables_&lt;PLATFORM&gt;.rc. There is no longer
any need to merge the generated variables files. It is probably
worth checking that the changes in these files are as expected.</p></li>
</ul>
</div>
</details><details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Updating KGO manually (rarely needed!)<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<ul class="simple">
<li><p class="sd-card-text">Create a new directory for the new KGO. The naming convention is
vnXX.X_tNNNN, where NNNN is the ticket number. The location of the
KGO for the nightly is $UMDIR/standard_jobs.</p></li>
<li><p class="sd-card-text">Copy the new KGO from your rose-stem run into the directory
vnXX.X_tNNNN created above. Note that you need to provide a
complete set of files, not just ones which have changed answers.
This includes the reconfiguration .astart file!</p></li>
<li><p class="sd-card-text">If a file hasn’t changed you can optionally symlink forwards from
the previous version (i.e. move the old file to the new KGO
directory and replace it with a sym-link to the updated version)
But do not do this if the old version was a major release revision
(vnX.X), this is to allow intermediate revisions to be deleted later.</p></li>
<li><p class="sd-card-text">Remember to RSync and update the bitcomparison table (see above).</p></li>
</ul>
</div>
</details></div>
<input id="sd-tab-item-17" name="sd-tab-set-3" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-17">
JULES</label><div class="sd-tab-content docutils">
<ol class="arabic simple">
<li><p>Run the standalone rose-stem with housekeeping switched off to generate new KGO.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rose</span> <span class="n">stem</span> <span class="o">--</span><span class="n">group</span><span class="o">=</span><span class="nb">all</span><span class="p">,</span><span class="n">ex1a</span> <span class="o">--</span><span class="n">source</span><span class="o">=.</span> <span class="o">-</span><span class="n">S</span> <span class="n">HOUSEKEEPING</span><span class="o">=</span><span class="n">false</span> <span class="o">--</span><span class="n">new</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Update KGO_VERSION in <cite>rose-stem/include/variables.rc</cite>.</p></li>
<li><p>Copy the new KGO to the correct locations:</p></li>
</ol>
<div class="highlight-RST notranslate"><div class="highlight"><pre><span></span>ssh -Y frum@localhost
KGO_VERSION=vnX.X_txxxx
USER_NAME=&lt;user&gt;
SUITE=&lt;suite&gt;

# Copy Linux output to the KGO location for Linux
KGO_DIR=/project/jules/rose-stem/jules-kgo/$KGO_VERSION; mkdir -p $KGO_DIR &amp;&amp; cp ~$USER_NAME/cylc-run/$SUITE/work/1/meto_linux_<span class="ge">*/output/*</span> $KGO_DIR

# Copy Cray output to the KGO location for the Cray
# If something goes wrong with the copy, try passing the full path (eg. /home/d01/USER/), not just ~$USER_NAME
ssh -Y xcel00
KGO_VERSION=vnX.X_txxxx
USER_NAME=&lt;user&gt;
SUITE=&lt;suite&gt;
KGO_DIR=/projects/jules/rose-stem-kgo/$KGO_VERSION; mkdir -p $KGO_DIR &amp;&amp; cp ~$USER_NAME/cylc-run/$SUITE/work/1/meto_xc40_<span class="ge">*/output/*</span> $KGO_DIR

# DON&#39;T forget the xcs!!!
rsync -avz $KGO_DIR xcslr0:/projects/jules/rose-stem-kgo/

exit
# check the xcslr0
ssh -Y xcslr0
KGO_VERSION=vnX.X_txxxx
KGO_DIR=/projects/jules/rose-stem-kgo/$KGO_VERSION
ls $KGO_DIR
exit

# Copy EXZ output to the KGO location for EXZ (note &lt;USERNAME&gt; format is firstname.surname!)
# If something goes wrong with the copy, try passing the full path (eg. /home/users/USER/), not just ~$USER_NAME
ssh -Y login.exz
KGO_VERSION=vnX.X_txxxx
USER_NAME=&lt;user&gt;
SUITE=&lt;suite&gt;
KGO_DIR=/common/jules/rose-stem-kgo/$KGO_VERSION; mkdir -p $KGO_DIR &amp;&amp; cp ~$USER_NAME/cylc-run/$SUITE/work/1/meto_ex1a_<span class="ge">*/output/*</span> $KGO_DIR

# DON&#39;T forget the exa!!!
rsync -avz $KGO_DIR login.exa.sc:/common/internal/jules/rose-stem-kgo/
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Rerun the rose-stem tests to make sure nothing is broken.</p></li>
</ol>
</div>
<input id="sd-tab-item-18" name="sd-tab-set-3" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-18">
LFRic Apps</label><div class="sd-tab-content docutils">
<p>KGO Checksums are stored in the repository alongside the code and can
be updated using a script. This can be done by either the code reviewer
or by the developer (before submitting their changes for review). In the
latter case, the update will need redoing by the reviewer before commit
if there are merge conflicts in the checksum files.</p>
<ol class="arabic simple">
<li><p>Run the rose stem tasks that require a KGO update, plus any other testing required (see above) - if unsure run the <cite>all</cite> group.</p></li>
</ol>
<div class="highlight-RST notranslate"><div class="highlight"><pre><span></span>export CYLC_VERSION=8
rose stem --group=all
cylc play &lt;suite name&gt;
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Run the checksum update script stored in <cite>&lt;working copy&gt;/rose-stem/bin</cite>.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="o">./</span><span class="n">rose</span><span class="o">-</span><span class="n">stem</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">update_branch_kgos</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">s</span> <span class="o">&lt;</span><span class="n">suite</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">w</span> <span class="o">&lt;</span><span class="n">path</span> <span class="n">to</span> <span class="n">working</span> <span class="n">copy</span><span class="o">&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This script requires at least python 3.9. This can be achieved on
Met Office machines by running <code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">load</span> <span class="pre">scitools</span></code></p>
</div>
</div>
<input id="sd-tab-item-19" name="sd-tab-set-3" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-19">
LFRic Core</label><div class="sd-tab-content docutils">
<p>KGO Checksums are stored in the repository alongside the code. If there
is a merge conflict within these files it is the developers responsibility
to update them.</p>
<ol class="arabic simple">
<li><p>Organise a trunk freeze for LFRic at a time when the developer is available</p></li>
<li><p>Developer updates their branch to the head of trunk and regenerates
the KGO checksums.</p></li>
<li><p>If there were also code conflicts in the science code then the new KGO
checksums will need to be signed off by the science reviewer.</p></li>
<li><p>Once the ticket is back with you, you can merge the branch to the
trunk and run the test-suite as described above to confirm that all
is working.</p></li>
</ol>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Between running any required testing and installing the KGO check that the
failing rose-ana tasks match those in the developers trac.log. If any have
failed for other reasons (e.g. timeout) then these should be re-triggered
before attempting to install the KGO files.</p>
</div>
</section>
<section id="commit">
<h2>5. Commit<a class="headerlink" href="#commit" title="Permalink to this heading">#</a></h2>
<p>Take a final review of the changes about to be applied looking for any obvious
merge errors</p>
<div class="highlight-RST notranslate"><div class="highlight"><pre><span></span>fcm diff -g
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Linked tickets will need to follow the sequence described <a class="reference internal" href="committinglinkedtickets.html#committinglinked"><span class="std std-ref">here</span></a>.</p>
</div>
<p>Commit the change to the trunk</p>
<div class="highlight-RST notranslate"><div class="highlight"><pre><span></span>fcm commit
</pre></div>
</div>
<p>An editor will open requesting a log message which should be in this format:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-20" name="sd-tab-set-4" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-20">
All others</label><div class="sd-tab-content docutils">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#ticket_number : Author : Ticket title</span>
</pre></div>
</div>
<p>where author is the srs username.</p>
</div>
<input id="sd-tab-item-21" name="sd-tab-set-4" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-21">
LFRic Core</label><div class="sd-tab-content docutils">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#&lt;ticket number&gt; for &lt;original author&gt;: &lt;ticket title&gt;</span>
</pre></div>
</div>
<p>where original author is the authors proper name.</p>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>New!! Remove any <strong>blocks:</strong> and <strong>blockedby:</strong> keywords from this ticket and any referenced. Comment on any unblocked tickets to alert the developers.</p>
</div>
<p>Update the ticket with the revision number of the commit, e.g. [100000] for revision 100000, comment whether the change is expected to alter results or not and update the ticket status to committed.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Don’t forget to let the team know you’ve finished with the trunks.</p>
</div>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Modifying log messages<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">If you need to modify the commit log message after commit, run this command and save to update the message:</p>
<div class="highlight-RST notranslate"><div class="highlight"><pre><span></span>fcm propedit --revprop svn:log -r xxxxxx fcm:um.x_tr
</pre></div>
</div>
</div>
</details></section>
<section id="close">
<h2>6. Close<a class="headerlink" href="#close" title="Permalink to this heading">#</a></h2>
<p>The following day review the nightly test harness results (details on <a class="reference external" href="https://code.metoffice.gov.uk/trac/um/wiki/TrunkStatus">Trunk Status</a>).</p>
<p>If nothing is broken then close the ticket, returning it to the original author.</p>
<p>If something is broken:</p>
<ul class="simple">
<li><p>Announce to the team and on <a class="reference external" href="https://code.metoffice.gov.uk/trac/um/wiki/TrunkStatus">Trunk Status</a>.</p></li>
<li><p>If there is an obvious bug, or a simple fix then update the original branch and re-merge into the trunk.</p></li>
<li><p>If there isn’t an easy fix then reverse the change to allow time for investigation.</p></li>
</ul>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Reversing Trunk Commits<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<ol class="arabic">
<li><p class="sd-card-text">Check out the trunk</p></li>
<li><dl>
<dt>Use the merge command to reverse the problematic change</dt><dd><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fcm</span> <span class="n">merge</span> <span class="o">--</span><span class="n">reverse</span> <span class="o">-</span><span class="n">r</span> <span class="o">&lt;</span><span class="n">revision</span><span class="o">&gt;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Check the reverse merge has worked and commit it to the trunk</dt><dd><ul class="simple">
<li><p class="sd-card-text">Use the same commit message format as usual.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p class="sd-card-text">Update the ticket with details of the problem and assign it back to the author to fix</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p class="sd-card-text">If and when the author provides a fixed version of the branch a custom
merge will be required (otherwise only the most recent commits will be merged).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fcm</span> <span class="n">merge</span> <span class="o">--</span><span class="n">custom</span> <span class="o">--</span><span class="n">revision</span> <span class="o">&lt;</span><span class="n">revision1</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">revision2</span><span class="o">&gt;</span> <span class="n">fcm</span><span class="p">:</span><span class="n">um</span><span class="o">.</span><span class="n">x_br</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">etc</span><span class="o">...</span>
</pre></div>
</div>
<p class="sd-card-text">where revision 1 and 2 are the initial copy and the last change to the branch to be committed.</p>
</div>
</div>
</details><div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><strong>Logging in as frum</strong></p>
<ul class="simple">
<li><p>To access the frum account your ssh key will need to be added to frum authorised keys.</p></li>
<li><p>When logged in to your linux desktop run <code class="docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">-Y</span> <span class="pre">frum&#64;localhost</span></code> and this will log you in as frum.
At this point you will be in UMDIR on the platform SPICE. You can then access frum on other machines via ssh -Y &lt;HOSTNAME&gt;.</p></li>
<li><p>Apart from on SPICE the frum home directories and UMDIR are separate. XCE/F share the same UMDIR and the UMDIR on XCS is kept in sync with this one.</p></li>
</ul>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="codereview.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Code and System Review</p>
      </div>
    </a>
    <a class="right-next"
       href="committinglinkedtickets.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Committing Linked Tickets</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#merge">1. Merge</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#macros-if-required">2. Macros (if required)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-if-no-kgo">3. Test (if no KGO)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#kgo-if-required">4. KGO (if required)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#commit">5. Commit</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#close">6. Close</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024,  Met Office.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.2.1.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>