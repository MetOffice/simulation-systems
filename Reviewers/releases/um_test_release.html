

<!DOCTYPE html>


<html lang="en" data-content_root="" data-theme="auto">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>UM Test Release &#8212; Simulation Systems  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "auto";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "auto";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Reviewers/releases/um_test_release';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Partner Testing" href="partner_testing.html" />
    <link rel="prev" title="Curating a Release" href="../curaterelease.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="auto">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/MO_SQUARE_black_mono_for_light_backg_RBG.png" class="logo__image only-light" alt=""/>
    <img src="../../_static/MO_SQUARE_for_dark_backg_RBG.png" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">Simulation Systems</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../WorkingPractices/working_practices.html">
    Working Practices
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Guides for Reviewers
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../FurtherDetails/index.html">
    Further Details
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/MetOffice/simulation-systems/discussions" title="GitHub Discussions" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="far fa-comments fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub Discussions</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../WorkingPractices/working_practices.html">
    Working Practices
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Guides for Reviewers
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../FurtherDetails/index.html">
    Further Details
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/MetOffice/simulation-systems/discussions" title="GitHub Discussions" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="far fa-comments fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub Discussions</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Guides for Reviewers</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../scitechreview.html">Science and Technical Review</a></li>
<li class="toctree-l1"><a class="reference internal" href="../codereview.html">Code and System Review</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../howtocommit.html">Merge, Test &amp; Commit</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../committinglinkedtickets.html">Committing Linked Tickets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nightlytesting.html">Nightly Testing</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../curaterelease.html">Curating a Release</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">UM Test Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="partner_testing.html">Partner Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="software_stack.html">Scientific Software Stack Update</a></li>
<li class="toctree-l2"><a class="reference internal" href="jules_release.html">Jules Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="shumlib_release.html">Shumlib Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="mule_release.html">Mule Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="um_main_release.html">UM Main Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="lfric_apps_release.html">LFRic Apps Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_notes.html">Release Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="standard_suites.html">Standard Suites</a></li>
<li class="toctree-l2"><a class="reference internal" href="stash_browser.html">Stash Browser</a></li>
<li class="toctree-l2"><a class="reference internal" href="umdp_release.html">UMDP Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="wiki_pages.html">Standard Jobs and Wiki Pages</a></li>
<li class="toctree-l2"><a class="reference internal" href="shared_accounts.html">Trunk and Shared Accounts Permissions</a></li>
<li class="toctree-l2"><a class="reference internal" href="updating_prebuilds.html">Mid-Release Prebuilds</a></li>
</ul>
</details></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Guides for Reviewers</a></li>
    
    
    <li class="breadcrumb-item"><a href="../curaterelease.html" class="nav-link">Curating a Release</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">UM Test Release</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="um-test-release">
<span id="id1"></span><h1>UM Test Release<a class="headerlink" href="#um-test-release" title="Permalink to this heading">#</a></h1>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>When referring to <strong>all</strong> platforms below, this means Azure Spice, EXAB, EXCD, EXZ</p>
<p>Some of the test release only needs to be run on 1 HPC Host Zone - the instructions for this assume EXAB, but EXCD can be used instead. Other parts of the test release set up files for the main release - this needs to be done on both EXAB and EXCD.</p>
</div>
<section id="preparing-test-release-branches-and-keyword-files">
<h2>Preparing Test Release Branches and Keyword Files<a class="headerlink" href="#preparing-test-release-branches-and-keyword-files" title="Permalink to this heading">#</a></h2>
<p>This will involve switching between your own and the umadmin account on Azure Spice and EXAB.</p>
<ul class="simple">
<li><p>As yourself, create a UM ticket for the test release, marked ‘Not for Builds’.</p></li>
<li><p>As yourself, create and check out a UM branch at the head of the trunk (or whichever revision of the trunk you wish to do a test release with).</p></li>
<li><p>As yourself, create and check out a head of trunk meta branch (<code class="docutils literal notranslate"><span class="pre">fcm:um_meta.x_tr&#64;head</span></code>).</p></li>
<li><p>As umadin, setup the <code class="docutils literal notranslate"><span class="pre">~/.metomi/fcm/keyword.cfg</span></code> file on Azure Spice to specify custom keywords for the UM, ​JULES, ​SOCRATES, ​CASIM, ​Shumlib, ​UKCA and the mirrors of each of these named after the upcoming version and pointing to the current head of trunk revisions of each project. No keywords are needed for mule, moci or meta repositories.</p></li>
<li><p>The general format looks like this- substitute model version and revisions</p>
<ul>
<li><p>Remember to remove any existing hashtags/make sure these lines aren’t commented out</p></li>
<li><p>For the test release we also need to set the Jules vn keyword (last line). This needs to match the jules version that is passed to release_new_version script below.</p></li>
</ul>
</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">revision</span><span class="p">[</span><span class="n">um</span><span class="o">.</span><span class="n">x</span><span class="p">:</span><span class="n">vn13</span><span class="mf">.5</span><span class="p">]</span>        <span class="o">=</span> <span class="mi">123059</span>
<span class="n">revision</span><span class="p">[</span><span class="n">jules</span><span class="o">.</span><span class="n">x</span><span class="p">:</span><span class="n">um13</span><span class="mf">.5</span><span class="p">]</span>     <span class="o">=</span> <span class="mi">28020</span>
<span class="n">revision</span><span class="p">[</span><span class="n">socrates</span><span class="o">.</span><span class="n">x</span><span class="p">:</span><span class="n">um13</span><span class="mf">.5</span><span class="p">]</span>  <span class="o">=</span> <span class="mi">1563</span>
<span class="n">revision</span><span class="p">[</span><span class="n">casim</span><span class="o">.</span><span class="n">x</span><span class="p">:</span><span class="n">um13</span><span class="mf">.5</span><span class="p">]</span>     <span class="o">=</span> <span class="mi">10951</span>
<span class="n">revision</span><span class="p">[</span><span class="n">shumlib</span><span class="o">.</span><span class="n">x</span><span class="p">:</span><span class="n">um13</span><span class="mf">.5</span><span class="p">]</span>   <span class="o">=</span> <span class="mi">7324</span>
<span class="n">revision</span><span class="p">[</span><span class="n">ukca</span><span class="o">.</span><span class="n">x</span><span class="p">:</span><span class="n">um13</span><span class="mf">.5</span><span class="p">]</span>      <span class="o">=</span> <span class="mi">3196</span>

<span class="n">revision</span><span class="p">[</span><span class="n">um</span><span class="o">.</span><span class="n">xm</span><span class="p">:</span><span class="n">vn13</span><span class="mf">.5</span><span class="p">]</span>       <span class="o">=</span> <span class="mi">123059</span>
<span class="n">revision</span><span class="p">[</span><span class="n">jules</span><span class="o">.</span><span class="n">xm</span><span class="p">:</span><span class="n">um13</span><span class="mf">.5</span><span class="p">]</span>    <span class="o">=</span> <span class="mi">28020</span>
<span class="n">revision</span><span class="p">[</span><span class="n">socrates</span><span class="o">.</span><span class="n">xm</span><span class="p">:</span><span class="n">um13</span><span class="mf">.5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1563</span>
<span class="n">revision</span><span class="p">[</span><span class="n">casim</span><span class="o">.</span><span class="n">xm</span><span class="p">:</span><span class="n">um13</span><span class="mf">.5</span><span class="p">]</span>    <span class="o">=</span> <span class="mi">10951</span>
<span class="n">revision</span><span class="p">[</span><span class="n">shumlib</span><span class="o">.</span><span class="n">xm</span><span class="p">:</span><span class="n">um13</span><span class="mf">.5</span><span class="p">]</span>  <span class="o">=</span> <span class="mi">7324</span>
<span class="n">revision</span><span class="p">[</span><span class="n">ukca</span><span class="o">.</span><span class="n">xm</span><span class="p">:</span><span class="n">um13</span><span class="mf">.5</span><span class="p">]</span>     <span class="o">=</span> <span class="mi">3196</span>

<span class="n">revision</span><span class="p">[</span><span class="n">jules</span><span class="o">.</span><span class="n">xm</span><span class="p">:</span><span class="n">vn7</span><span class="mf">.5</span><span class="p">]</span>     <span class="o">=</span> <span class="mi">28020</span>
</pre></div>
</div>
<ul class="simple">
<li><p>As umadmin, scp this file to the EXAB, <code class="docutils literal notranslate"><span class="pre">scp</span> <span class="pre">~/.metomi/fcm/keyword.cfg</span> <span class="pre">login.exab.sc:.metomi/fcm/keyword.cfg</span></code></p></li>
<li><p>As yourself, copy this file into your own homespace ready for testing later, <code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">~umadmin/.metomi/fcm/keyword.cfg</span> <span class="pre">~/.metomi/fcm/keyword.cfg</span></code>. Do this on Azure Spice and EXAB.</p></li>
<li><p>As yourself, add the following to <code class="docutils literal notranslate"><span class="pre">~/.metomi/rose.conf</span></code> on Azure Spice and EXAB. This prevents kgo failures due to the new version number when we test later. Again, do this on Azure Spice and EXAB.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">rose</span><span class="o">-</span><span class="n">ana</span><span class="p">]</span>
<span class="n">bypass</span><span class="o">-</span><span class="n">version</span><span class="o">-</span><span class="n">check</span><span class="o">=.</span><span class="n">true</span><span class="o">.</span>
</pre></div>
</div>
</section>
<section id="running-the-release-script">
<h2>Running the Release Script<a class="headerlink" href="#running-the-release-script" title="Permalink to this heading">#</a></h2>
<p>As yourself, move into the rose-stem directory in the UM working copy where the release new version script will be run from. The syntax is,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">../</span><span class="n">admin</span><span class="o">/</span><span class="n">rose</span><span class="o">-</span><span class="n">stem</span><span class="o">/</span><span class="n">release_new_version</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">c</span> <span class="o">&lt;</span><span class="n">previous</span> <span class="n">version</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">n</span> <span class="o">&lt;</span><span class="n">new</span> <span class="n">version</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">j</span> <span class="o">&lt;</span><span class="n">new</span> <span class="o">*</span><span class="n">JULES</span><span class="o">*</span> <span class="n">version</span><span class="o">&gt;</span>
<span class="n">eg</span><span class="o">.</span> <span class="o">../</span><span class="n">admin</span><span class="o">/</span><span class="n">rose</span><span class="o">-</span><span class="n">stem</span><span class="o">/</span><span class="n">release_new_version</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">c</span> <span class="mf">13.4</span> <span class="o">-</span><span class="n">n</span> <span class="mf">13.5</span> <span class="o">-</span><span class="n">j</span> <span class="mf">7.5</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Open a new terminal and inspect that the version number update macro added by the script is correct, and that the tXXXX template macro has been deleted appropriately.</p>
<ul>
<li><p>This has caused problems before see <cite>this edge case &lt;https://code.metoffice.gov.uk/trac/um/wiki/ticket/2437/SciTechReview&gt;</cite>. The upgrade macro should fail to execute if the macro chain is incorrect, as it won’t be able to upgrade an app to the new version - this is likely this edge case.</p></li>
</ul>
</li>
<li><p>As there is no kgo installed for the new version revert the changes to <code class="docutils literal notranslate"><span class="pre">rose-stem/site/meto/variables_*.cylc</span></code> as well as the <code class="docutils literal notranslate"><span class="pre">BASE</span></code> variable at the bottom of <code class="docutils literal notranslate"><span class="pre">rose-stem/site/meto/variables.cylc</span></code>.</p></li>
</ul>
</section>
<section id="copying-the-metadata-and-upgrade-macros-to-the-um-meta-branch">
<h2>Copying the metadata and upgrade macros to the um_meta branch<a class="headerlink" href="#copying-the-metadata-and-upgrade-macros-to-the-um-meta-branch" title="Permalink to this heading">#</a></h2>
<p>As yourself, the next step is to move the macros and metadata into the meta branch. The metadata will have been created already by the release script.
Below shows an example of the commands run to move from 11.4 to 11.5, from the top directory of the working copy of the UM branch,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>version=&quot;version114_115.py&quot;
vn=&quot;vn11.5&quot;
path=&quot;/path/to/meta/working_copy&quot;

fcm mv rose-meta/um-atmos/$version $path/um-atmos/$version
fcm mv rose-meta/um-fcm-make/$version $path/um-fcm-make/$version
fcm mv rose-meta/um-createbc/$version $path/um-createbc/$version

fcm mv rose-meta/um-atmos/$vn $path/um-atmos/$vn
fcm mv rose-meta/um-fcm-make/$vn $path/um-fcm-make/$vn
fcm mv rose-meta/um-createbc/$vn $path/um-createbc/$vn
</pre></div>
</div>
<p>Note: there is no need to move um-crmstyle as it only contains HEAD metadata.</p>
<p>Manually add a line to each of the um-atmos/versions.py, um-fcm-make/versions.py and um-createbc/versions.py files in the meta branch to import the newly copied versionXX_XY.py file.</p>
<p>Commit the changes to both the UM and Meta branches.</p>
</section>
<section id="installing-ctldata-utilities-and-prebuilds">
<h2>Installing Ctldata, Utilities and Prebuilds<a class="headerlink" href="#installing-ctldata-utilities-and-prebuilds" title="Permalink to this heading">#</a></h2>
<p>These steps are all done as umadmin</p>
<p>Check out the UM trunk into a working copy. umadmin can only check out from the mirror - if immediately following the previous steps, ensure the mirror has updated.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fcm</span> <span class="n">co</span> <span class="n">fcm</span><span class="p">:</span><span class="n">um</span><span class="o">.</span><span class="n">xm_tr</span><span class="nd">@vnX</span><span class="o">.</span><span class="n">Y</span> <span class="n">umX</span><span class="o">.</span><span class="n">Y_install</span>
<span class="n">cd</span> <span class="n">umX</span><span class="o">.</span><span class="n">Y_install</span>
</pre></div>
</div>
<p>First check that the upgrade has gone successfully and the new install will appear in the correct place. Do this by running,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rose</span> <span class="n">stem</span> <span class="o">--</span><span class="n">group</span><span class="o">=</span><span class="n">install</span> <span class="n">rose</span><span class="o">-</span><span class="n">stem</span> <span class="o">-</span><span class="n">S</span> <span class="n">CENTRAL_INSTALL</span><span class="o">=</span><span class="n">false</span> <span class="o">-</span><span class="n">S</span> <span class="n">PREBUILDS</span><span class="o">=</span><span class="n">false</span> <span class="o">-</span><span class="n">S</span> <span class="n">USE_EXAB</span><span class="o">=</span><span class="n">true</span>
<span class="n">cylc</span> <span class="n">play</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">suite</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>and check that <code class="docutils literal notranslate"><span class="pre">~umadmin/cylc_run/&lt;working_copy_name&gt;/runN/share/vnX.Y</span></code> exists and is the new version number. If that has worked, change the CENTRALL_INSTALL flag to true and rerun,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rose</span> <span class="n">stem</span> <span class="o">--</span><span class="n">group</span><span class="o">=</span><span class="n">install</span> <span class="n">rose</span><span class="o">-</span><span class="n">stem</span> <span class="o">-</span><span class="n">S</span> <span class="n">CENTRAL_INSTALL</span><span class="o">=</span><span class="n">true</span> <span class="o">-</span><span class="n">S</span> <span class="n">PREBUILDS</span><span class="o">=</span><span class="n">false</span> <span class="o">-</span><span class="n">S</span> <span class="n">USE_EXAB</span><span class="o">=</span><span class="n">true</span>
<span class="n">cylc</span> <span class="n">play</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">suite</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Now install the prebuilds by running,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rose</span> <span class="n">stem</span> <span class="o">--</span><span class="n">group</span><span class="o">=</span><span class="n">prebuilds</span> <span class="o">-</span><span class="n">S</span> <span class="n">MAKE_PREBUILDS</span><span class="o">=</span><span class="n">true</span> <span class="o">--</span><span class="n">workflow</span><span class="o">-</span><span class="n">name</span><span class="o">=</span><span class="n">vnX</span><span class="o">.</span><span class="n">Y_prebuilds</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">run</span><span class="o">-</span><span class="n">name</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>In the main release, we use cylc7 for the prebuild install as the Cylc8 rose-stem is missing a feature. As we are going to be removing these prebuilds shortly, the default Cylc8 is fine for the test release.</p>
</div>
<p>Navigate to the input data directory on azure spice (<code class="docutils literal notranslate"><span class="pre">$UMDIR/standard_jobs/inputs</span></code>) and run the following command which copies the old directory to the new one, and then creates a new symlink. Replace 11.5 and 11.6 with the correct version numbers,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mv</span> <span class="n">vn11</span><span class="mf">.5</span> <span class="n">vn11</span><span class="mf">.6</span> <span class="o">&amp;&amp;</span> <span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="n">vn11</span><span class="mf">.6</span> <span class="n">vn11</span><span class="mf">.5</span>
</pre></div>
</div>
<p>Repeat this step on <strong>all of</strong> EXAB, EXCD and EXZ.</p>
</section>
<section id="test-the-branch">
<h2>Test the Branch<a class="headerlink" href="#test-the-branch" title="Permalink to this heading">#</a></h2>
<p>These steps are done as yourself.
In your UM branch working copy, ensure the <code class="docutils literal notranslate"><span class="pre">PREBUILDS</span></code> variable in <code class="docutils literal notranslate"><span class="pre">rose-stem/site/meto/variables.cylc</span></code> is set to true so we test the new prebuilds.
Then run the entire test suite,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rose</span> <span class="n">stem</span> <span class="o">--</span><span class="n">group</span><span class="o">=</span><span class="nb">all</span> <span class="o">--</span><span class="n">source</span><span class="o">=.</span> <span class="o">--</span><span class="n">source</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">meta</span><span class="o">/</span><span class="n">working</span><span class="o">/</span><span class="n">copy</span>
<span class="n">cylc</span> <span class="n">play</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">suite</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Before continuing the next step you should make sure the suite has run as expected. All tests should pass apart from any tasks that output netcdf (these have _nc in the tasks name) and the SCM tasks. Both of these encode the UM version and use a direct comparison, it is not as simple to exclude UM version from the comparison as we did with tests that use mule-cumf.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Check the test results by running something like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">find</span> <span class="o">~</span><span class="n">cylc</span><span class="o">-</span><span class="n">run</span><span class="o">/&lt;</span><span class="n">suite</span> <span class="n">name</span><span class="o">&gt;/</span><span class="n">runN</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">job</span> <span class="o">-</span><span class="n">path</span> <span class="s2">&quot;*rose_ana*&quot;</span> <span class="o">-</span><span class="nb">type</span> <span class="n">f</span> <span class="o">-</span><span class="n">name</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span> <span class="o">|</span> <span class="n">xargs</span> <span class="n">grep</span> <span class="o">-</span><span class="n">l</span> <span class="n">CYLC_JOB_EXIT</span><span class="o">=</span><span class="n">ERR</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">vE</span> <span class="s2">&quot;(scm|netcdf)</span>
</pre></div>
</div>
</div>
</section>
<section id="test-on-monsoon">
<h2>Test on Monsoon<a class="headerlink" href="#test-on-monsoon" title="Permalink to this heading">#</a></h2>
<p>It’s also sensible to check now that nothing has broken on Monsoon. Do this by copying your keyword settings across to your account on there. Then check out the UM main and meta branches and run the test suite as you in the previous section except for the group which should now be <code class="docutils literal notranslate"><span class="pre">ex1a</span></code>.</p>
</section>
<section id="reset-keywords-and-remove-prebuilds-important">
<h2>Reset Keywords and Remove Prebuilds (Important!)<a class="headerlink" href="#reset-keywords-and-remove-prebuilds-important" title="Permalink to this heading">#</a></h2>
<p>As both yourself and umadmin,</p>
<ul class="simple">
<li><p>Remove or comment out the custom keyword revisions from <code class="docutils literal notranslate"><span class="pre">~/.metomi/fcm/keywords.cfg</span></code></p></li>
<li><p>Remove or comment out the <code class="docutils literal notranslate"><span class="pre">bypass-version-check</span></code> in <code class="docutils literal notranslate"><span class="pre">~/.metomi/rose.conf</span></code></p>
<ul>
<li><p>Make sure to do this on <strong>all</strong> platforms (inlcuding Monsoon)</p></li>
<li><p>Not doing so can result in some weird behaviour down the line</p></li>
</ul>
</li>
<li><p>As umadmin, remove the installed release and prebuilds. Doing this now saves significant time during the actual release. These steps should only need doing on Azure Spice and EXAB.</p>
<ul>
<li><p>Delete the <code class="docutils literal notranslate"><span class="pre">$UMDIR/vnX.Y</span></code> directory</p></li>
<li><p>On Azure Spice, run <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">clean</span> <span class="pre">--timeout=5000</span> <span class="pre">vnX.Y_prebuilds</span></code>. Once this has finished, check the cylc-run directory that the suite has been removed. Do this on all of $HOME, $DATADIR, $SCRATCH on both Azure Spice and EXAB.</p></li>
</ul>
</li>
</ul>
<p>The test release is now done!</p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../curaterelease.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Curating a Release</p>
      </div>
    </a>
    <a class="right-next"
       href="partner_testing.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Partner Testing</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparing-test-release-branches-and-keyword-files">Preparing Test Release Branches and Keyword Files</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-release-script">Running the Release Script</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#copying-the-metadata-and-upgrade-macros-to-the-um-meta-branch">Copying the metadata and upgrade macros to the um_meta branch</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installing-ctldata-utilities-and-prebuilds">Installing Ctldata, Utilities and Prebuilds</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-the-branch">Test the Branch</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-on-monsoon">Test on Monsoon</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reset-keywords-and-remove-prebuilds-important">Reset Keywords and Remove Prebuilds (Important!)</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

<p class="copyright">
    
    © Crown Copyright, Met Office 2023.
    <br/>
    
</p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.2.1.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>