

<!DOCTYPE html>


<html lang="en" data-content_root="" data-theme="auto">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>UM Main Release &#8212; Simulation Systems  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "auto";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "auto";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Reviewers/releases/um_main_release';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="LFRic Apps Release" href="lfric_apps_release.html" />
    <link rel="prev" title="Mule Release" href="mule_release.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="auto">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/MO_SQUARE_black_mono_for_light_backg_RBG.png" class="logo__image only-light" alt=""/>
    <img src="../../_static/MO_SQUARE_for_dark_backg_RBG.png" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">Simulation Systems</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../WorkingPractices/working_practices.html">
    Working Practices
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Guides for Reviewers
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../FurtherDetails/index.html">
    Further Details
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/MetOffice/simulation-systems/discussions" title="GitHub Discussions" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="far fa-comments fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub Discussions</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../WorkingPractices/working_practices.html">
    Working Practices
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Guides for Reviewers
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../FurtherDetails/index.html">
    Further Details
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/MetOffice/simulation-systems/discussions" title="GitHub Discussions" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="far fa-comments fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub Discussions</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Guides for Reviewers</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../scitechreview.html">Science and Technical Review</a></li>
<li class="toctree-l1"><a class="reference internal" href="../codereview.html">Code and System Review</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../howtocommit.html">Merge, Test &amp; Commit</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../committinglinkedtickets.html">Committing Linked Tickets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nightlytesting.html">Nightly Testing</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../curaterelease.html">Curating a Release</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="um_test_release.html">UM Test Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="partner_testing.html">Partner Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="software_stack.html">Scientific Software Stack Update</a></li>
<li class="toctree-l2"><a class="reference internal" href="jules_release.html">Jules Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="shumlib_release.html">Shumlib Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="mule_release.html">Mule Release</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">UM Main Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="lfric_apps_release.html">LFRic Apps Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_notes.html">Release Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="standard_suites.html">Standard Suites</a></li>
<li class="toctree-l2"><a class="reference internal" href="stash_browser.html">Stash Browser</a></li>
<li class="toctree-l2"><a class="reference internal" href="umdp_release.html">UMDP Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="wiki_pages.html">Standard Jobs and Wiki Pages</a></li>
<li class="toctree-l2"><a class="reference internal" href="shared_accounts.html">Trunk and Shared Accounts Permissions</a></li>
<li class="toctree-l2"><a class="reference internal" href="updating_prebuilds.html">Mid-Release Prebuilds</a></li>
</ul>
</details></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Guides for Reviewers</a></li>
    
    
    <li class="breadcrumb-item"><a href="../curaterelease.html" class="nav-link">Curating a Release</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">UM Main Release</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="um-main-release">
<span id="id1"></span><h1>UM Main Release<a class="headerlink" href="#um-main-release" title="Permalink to this heading">#</a></h1>
<section id="create-a-ticket-and-create-branches">
<h2>Create a ticket and Create Branches<a class="headerlink" href="#create-a-ticket-and-create-branches" title="Permalink to this heading">#</a></h2>
<p>To document the process create a ticket and put a link to it on the release curation ticket. You may wish to include links to the UM and UM metadata branches required and a wiki page for the reviews.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Documents</span> <span class="n">the</span> <span class="s1">&#39;Build and install the &lt;main/test&gt; UM release&#39;</span>

<span class="n">NOTES</span><span class="p">:</span> <span class="n">Any</span> <span class="n">changes</span> <span class="n">required</span> <span class="n">that</span> <span class="n">are</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">direct</span> <span class="n">instruction</span> <span class="kn">from</span><span class="w"> </span><span class="nn">this</span> <span class="n">section</span> <span class="n">of</span> <span class="n">the</span> <span class="n">guide</span><span class="o">.</span>

<span class="sd">&#39;&#39;&#39;Branch :&#39;&#39;&#39;</span> <span class="p">[</span><span class="n">log</span><span class="p">:</span><span class="n">main</span><span class="o">/</span><span class="n">branches</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">branch_path_n_name</span> <span class="n">dev</span><span class="o">/</span><span class="n">branch_path_n_name</span><span class="p">]</span>
<span class="sd">&#39;&#39;&#39;Meta Branch :&#39;&#39;&#39;</span> <span class="p">[</span><span class="n">log</span><span class="p">:</span><span class="n">meta</span><span class="o">/</span><span class="n">branches</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">branch_path_n_name</span> <span class="n">dev</span><span class="o">/</span><span class="n">branch_path_n_name</span><span class="p">]</span>
<span class="sd">&#39;&#39;&#39;[wiki:ticket/ticket_no/CodeSystemReview Code/System Review]&#39;&#39;&#39;</span>
</pre></div>
</div>
<p>Create and check out both a head of trunk UM branch and a head of trunk UM meta branch. Then update the ticket description.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fcm</span> <span class="n">bc</span> <span class="o">-</span><span class="n">k</span> <span class="n">ticket_no</span> <span class="n">vn11</span><span class="mf">.5</span><span class="n">_um_release</span> <span class="n">fcm</span><span class="p">:</span><span class="n">um</span><span class="o">.</span><span class="n">x_tr</span>
<span class="n">fcm</span> <span class="n">co</span> <span class="n">fcm</span><span class="p">:</span><span class="n">um</span><span class="o">.</span><span class="n">x_br</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">username</span><span class="o">/</span><span class="n">r12345_vn11</span><span class="mf">.5</span><span class="n">_um_release</span>
<span class="n">fcm</span> <span class="n">bc</span> <span class="o">-</span><span class="n">k</span> <span class="n">ticket_no</span> <span class="n">vn11</span><span class="mf">.5</span><span class="n">_meta_release</span> <span class="n">fcm</span><span class="p">:</span><span class="n">um_meta</span><span class="o">.</span><span class="n">x_tr</span>
<span class="n">fcm</span> <span class="n">co</span> <span class="n">fcm</span><span class="p">:</span><span class="n">um_meta</span><span class="o">.</span><span class="n">x_br</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">username</span><span class="o">/</span><span class="n">r12345_vn11</span><span class="mf">.5</span><span class="n">_meta_release</span>
</pre></div>
</div>
</section>
<section id="tagging-feeder-trunks">
<h2>Tagging Feeder Trunks<a class="headerlink" href="#tagging-feeder-trunks" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="../curaterelease.html#reference-tagging"><span class="std std-ref">Tag</span></a> the head of the feeder repositories with keywords for the new UM version if they do not already exist.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fcm:casim.x</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fcm:jules.x</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fcm:shumlib.x</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fcm:socrates.x</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fcm:ukca.x</span></code></p></li>
</ul>
<p>Send an email to all repository owners to let them know that the the head of the trunk has been tagged.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Jules should already have been done by the Jules release, but this is worth checking.</p>
</div>
</section>
<section id="apply-code-styling">
<h2>Apply Code Styling<a class="headerlink" href="#apply-code-styling" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Switch to the UM branch</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">RUNFULL=1</span></code> then run ./admin/code_styling/apply_styling</p></li>
<li><p>If any files have changed, check nothing has gone wrong with a quick compile <code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">stem</span> <span class="pre">--group=fcm_make_ex1a_gnu_um_rigorous_omp</span></code></p></li>
<li><p>Commit any changes</p></li>
</ul>
</section>
<section id="checking-metadata-and-rose-apps">
<h2>Checking Metadata and Rose Apps<a class="headerlink" href="#checking-metadata-and-rose-apps" title="Permalink to this heading">#</a></h2>
<p>The JULES release must be completed first and all jules-shared metadata changes from the JULES repository must be centrally installed before progressing.</p>
<ul class="simple">
<li><p>First switch to the UM branch.</p></li>
<li><p>Check that the metadata meets the Rose standards: run <code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">config-dump</span> <span class="pre">-C</span> <span class="pre">rose-meta</span></code>. Do this before running release_new_version, so that any metadata errors are fixed before the new vnX.Y metadata directories are created, otherwise you’ll have to check both vnX.Y and HEAD.</p>
<ul>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">fcm</span> <span class="pre">diff</span></code> on HEAD. Are the changes sensible? They often just involve moving sections of meta-data to be in the correct alphabetical order. However, <a class="reference external" href="https://code.metoffice.gov.uk/trac/um/ticket/1824">UM:#1824</a> added comments for some additional triggers ([43853]) to circumvent a ​bug in Rose. Running config-dump will move the location of these comments to the bottom of the that item’s metadata. Check for any moved references to “issue 2107” (there should be 4 of them) and put them back in the right places by hand, by referring to an unaltered copy of the trunk.</p></li>
</ul>
</li>
<li><p>Check rose-stem meets the Rose standards: run <code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">config-dump</span> <span class="pre">-C</span> <span class="pre">rose-stem/app</span></code>. The version upgrade macro should have reformatted all the atmos and fcm-make apps, so they should be correct. Are there any other changes (e.g. to rose-ana apps)? Are they understood? Commit them to the branch or discuss with the team as appropriate.</p></li>
<li><p>Commit all changes before moving onto the next section</p></li>
</ul>
</section>
<section id="running-the-release-script">
<h2>Running the Release Script<a class="headerlink" href="#running-the-release-script" title="Permalink to this heading">#</a></h2>
<p>Move into the rose-stem directory in the UM working copy where the release new version script will be run from. The syntax is,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">../</span><span class="n">admin</span><span class="o">/</span><span class="n">rose</span><span class="o">-</span><span class="n">stem</span><span class="o">/</span><span class="n">release_new_version</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">c</span> <span class="o">&lt;</span><span class="n">previous</span> <span class="n">version</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">n</span> <span class="o">&lt;</span><span class="n">new</span> <span class="n">version</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">j</span> <span class="o">&lt;</span><span class="n">new</span> <span class="o">*</span><span class="n">JULES</span><span class="o">*</span> <span class="n">version</span><span class="o">&gt;</span>
<span class="n">eg</span><span class="o">.</span> <span class="o">../</span><span class="n">admin</span><span class="o">/</span><span class="n">rose</span><span class="o">-</span><span class="n">stem</span><span class="o">/</span><span class="n">release_new_version</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">c</span> <span class="mf">13.4</span> <span class="o">-</span><span class="n">n</span> <span class="mf">13.5</span> <span class="o">-</span><span class="n">j</span> <span class="mf">7.5</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Open a new terminal and inspect that the version number update macro added by the script is correct, and that the tXXXX template macro has been deleted appropriately.</p>
<ul>
<li><p>This has caused problems before see <a class="reference external" href="https://code.metoffice.gov.uk/trac/um/wiki/ticket/2437/SciTechReview">this edge case</a>. The upgrade macro should fail to execute if the macro chain is incorrect, as it won’t be able to upgrade an app to the new version - this is likely this edge case.</p></li>
</ul>
</li>
</ul>
</section>
<section id="copying-the-metadata-and-upgrade-macros-to-the-um-meta-branch">
<h2>Copying the metadata and upgrade macros to the um_meta branch<a class="headerlink" href="#copying-the-metadata-and-upgrade-macros-to-the-um-meta-branch" title="Permalink to this heading">#</a></h2>
<p>The next step is to move the macros and metadata into the meta branch. The metadata will have been created already by the release script.
Below shows an example of the commands run to move from 11.4 to 11.5, from the top directory of the working copy of the UM branch,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>version=&quot;version114_115.py&quot;
vn=&quot;vn11.5&quot;
path=&quot;/path/to/meta/working_copy&quot;

fcm mv rose-meta/um-atmos/$version $path/um-atmos/$version
fcm mv rose-meta/um-fcm-make/$version $path/um-fcm-make/$version
fcm mv rose-meta/um-createbc/$version $path/um-createbc/$version

fcm mv rose-meta/um-atmos/$vn $path/um-atmos/$vn
fcm mv rose-meta/um-fcm-make/$vn $path/um-fcm-make/$vn
fcm mv rose-meta/um-createbc/$vn $path/um-createbc/$vn
</pre></div>
</div>
<p>Note: there is no need to move um-crmstyle as it only contains HEAD metadata.</p>
<p>Manually add a line to each of the um-atmos/versions.py, um-fcm-make/versions.py and um-createbc/versions.py files in the meta branch to import the newly copied versionXX_XY.py file.</p>
<p>Commit the changes to both the UM and Meta branches.</p>
</section>
<section id="final-checks">
<h2>Final Checks<a class="headerlink" href="#final-checks" title="Permalink to this heading">#</a></h2>
<p><strong>UM AUX Changes</strong></p>
<p>If there are changes to the AUX trunk in this release, are we picking up the head of the AUX trunk (fcm:um_aux)?
A new keyword will need to be created and copied into the rose-stem/rose-suite.conf file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fcm</span> <span class="n">co</span> <span class="o">-</span><span class="n">q</span> <span class="o">-</span><span class="n">N</span> <span class="n">fcm</span><span class="p">:</span><span class="n">um_aux</span><span class="o">.</span><span class="n">x</span> <span class="n">aux</span>
<span class="n">fcm</span> <span class="n">log</span> <span class="o">-</span><span class="n">l1</span> <span class="n">fcm</span><span class="p">:</span><span class="n">um_aux</span><span class="o">.</span><span class="n">x</span><span class="o">/</span><span class="n">trunk</span>
<span class="n">cd</span> <span class="n">aux</span>
<span class="n">fcm</span> <span class="n">pe</span> <span class="n">fcm</span><span class="p">:</span><span class="n">revision</span> <span class="o">.</span>
<span class="n">fcm</span> <span class="n">commit</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Updating <code class="docutils literal notranslate"><span class="pre">HOST_SOURCE_UM_AUX</span></code> with the new keyword is NOT done automatically by release_new_version.py as it doesn’t need to be done every release</p>
</div>
<p><strong>Other Points</strong></p>
<ul class="simple">
<li><p>Make sure the prebuilds are set to <code class="docutils literal notranslate"><span class="pre">true</span></code> in the <code class="docutils literal notranslate"><span class="pre">site/meto/variables.cylc</span></code> by checking the line, <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">do</span> <span class="pre">SITE_VARS.update({&quot;PREBUILDS&quot;</span> <span class="pre">:</span> <span class="pre">true})</span> <span class="pre">%}</span></code></p></li>
<li><p>Check rose-stem/rose-suite.conf?</p>
<ul>
<li><p>Are the UM, JULES, SOCRATES, CASIM and UKCA versions correct? These should be the keywords setup earlier.</p></li>
<li><p>Is housekeeping <code class="docutils literal notranslate"><span class="pre">true</span></code>?</p></li>
<li><p>Are the KGO versions correct in the <code class="docutils literal notranslate"><span class="pre">variables.cylc</span></code> file for each site?</p></li>
<li><p>Does the minimum version of Rose/Cylc need to be increased? (Do any rose-ana changes require new functionality?)</p></li>
<li><p>Do any of the apps or parts of the suites reference <code class="docutils literal notranslate"><span class="pre">$UMDIR</span></code> - they shouldn’t (the correct thing to do is to reference <code class="docutils literal notranslate"><span class="pre">$UM_INSTALL_DIR</span></code>).</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">grep</span></code> for any instances of the old version keyword(s). Fix as required and add any corrections to the instructions on this page too.</p></li>
</ul>
<p>Commit any changes resulting from these final checks.</p>
</section>
<section id="preparing-to-test">
<h2>Preparing to Test<a class="headerlink" href="#preparing-to-test" title="Permalink to this heading">#</a></h2>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>When referring to <strong>all</strong> platforms below, this means Azure Spice, EXAB, EXCD, EXZ</p>
</div>
<ul>
<li><p>Check that a <code class="docutils literal notranslate"><span class="pre">$UMDIR/standard_jobs/inputs/vnX.Y</span></code> input data directory exists in UMDIR on <strong>all</strong> platforms - this should have been done as part of the test release.</p>
<ul class="simple">
<li><p>If not, rename the inputs directory <code class="docutils literal notranslate"><span class="pre">$UMDIR/standard_jobs/inputs/vnX.Y</span></code> to the new version number and be sure to symlink the previous version to it. Do this all on one line to minimise any glitches during the rename. This needs to be repeated on all platforms. i.e. to update from vn11.5 to vn11.6 one would run, <code class="docutils literal notranslate"><span class="pre">mv</span> <span class="pre">vn11.5</span> <span class="pre">vn11.6;</span> <span class="pre">ln</span> <span class="pre">-s</span> <span class="pre">vn11.6</span> <span class="pre">vn11.5</span></code>.</p></li>
</ul>
</li>
<li><p>Local keywords for the UM should be put in your <code class="docutils literal notranslate"><span class="pre">~/.metomi/fcm/keyword.cfg</span></code> file on <strong>all</strong> platforms (don’t forget to remove them afterwards). The tag should correspond to the version you are releasing and the version number should be the revision of the trunk from which you branched. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">revision</span><span class="p">[</span><span class="n">um</span><span class="o">.</span><span class="n">x</span><span class="p">:</span><span class="n">vn10</span><span class="mf">.0</span><span class="p">]</span>                    <span class="o">=</span> <span class="mi">112</span>
<span class="n">revision</span><span class="p">[</span><span class="n">um</span><span class="o">.</span><span class="n">xm</span><span class="p">:</span><span class="n">vn10</span><span class="mf">.0</span><span class="p">]</span>                   <span class="o">=</span> <span class="mi">112</span>
</pre></div>
</div>
</li>
<li><p>For the rose_ana tasks to pass new KGO also needs to be generated for the new version, since you are about to run the <code class="docutils literal notranslate"><span class="pre">all</span></code> group test anyway you should use this opportunity to produce a new set of KGO.</p>
<ul class="simple">
<li><p>KGO is installed using the scripts in SimSys_Scripts. In order for the script to work you must first change the KGO directories in the <code class="docutils literal notranslate"><span class="pre">variables.cylc</span></code> and platform-specific <code class="docutils literal notranslate"><span class="pre">variables_PLATFORM.cylc</span></code> files back to whichever versions were present before the <code class="docutils literal notranslate"><span class="pre">release_new_version.py</span></code> script was run - you can do this with a simple copy from the head of the trunk. Be careful to ensure this is only changing the KGO versions for each variable as expected. <strong>DO NOT COMMIT this change - you will be reverting it later</strong>.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fcm</span> <span class="n">export</span> <span class="o">--</span><span class="n">force</span> <span class="n">fcm</span><span class="p">:</span><span class="n">um</span><span class="o">.</span><span class="n">x_tr</span><span class="o">/</span><span class="n">rose</span><span class="o">-</span><span class="n">stem</span><span class="o">/</span><span class="n">site</span><span class="o">/</span><span class="n">meto</span><span class="o">/</span><span class="n">variables</span><span class="o">.</span><span class="n">cylc</span> <span class="n">rose</span><span class="o">-</span><span class="n">stem</span><span class="o">/</span><span class="n">site</span><span class="o">/</span><span class="n">meto</span><span class="o">/</span>
<span class="n">fcm</span> <span class="n">export</span> <span class="o">--</span><span class="n">force</span> <span class="n">fcm</span><span class="p">:</span><span class="n">um</span><span class="o">.</span><span class="n">x_tr</span><span class="o">/</span><span class="n">rose</span><span class="o">-</span><span class="n">stem</span><span class="o">/</span><span class="n">site</span><span class="o">/</span><span class="n">meto</span><span class="o">/</span><span class="n">variables_azspice</span><span class="o">.</span><span class="n">cylc</span> <span class="n">rose</span><span class="o">-</span><span class="n">stem</span><span class="o">/</span><span class="n">site</span><span class="o">/</span><span class="n">meto</span><span class="o">/</span>
<span class="n">fcm</span> <span class="n">export</span> <span class="o">--</span><span class="n">force</span> <span class="n">fcm</span><span class="p">:</span><span class="n">um</span><span class="o">.</span><span class="n">x_tr</span><span class="o">/</span><span class="n">rose</span><span class="o">-</span><span class="n">stem</span><span class="o">/</span><span class="n">site</span><span class="o">/</span><span class="n">meto</span><span class="o">/</span><span class="n">variables_ex1a</span><span class="o">.</span><span class="n">cylc</span> <span class="n">rose</span><span class="o">-</span><span class="n">stem</span><span class="o">/</span><span class="n">site</span><span class="o">/</span><span class="n">meto</span><span class="o">/</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Current KGO files will have the older UM version in the fixed length header and lookups. In order for the rose-ana tasks that use mule-cumf to not give false rose-ana failures we must temporarily ignore the model version. There is some logic in the UM rose stem suite to enable this. Open your <code class="docutils literal notranslate"><span class="pre">~/.metomi/rose.conf</span></code> file, on <strong>all</strong> platforms, and add the following lines to the rose-ana section, making sure that bypass-version-check is true:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">rose</span><span class="o">-</span><span class="n">ana</span><span class="p">]</span>
<span class="n">bypass</span><span class="o">-</span><span class="n">version</span><span class="o">-</span><span class="n">check</span><span class="o">=.</span><span class="n">true</span><span class="o">.</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="testing-and-kgo-generation">
<h2>Testing and KGO Generation<a class="headerlink" href="#testing-and-kgo-generation" title="Permalink to this heading">#</a></h2>
<p>As yourself, and in the working copy of the UM branch run rose stem, be sure not to forget the source argument to the UM metadata branch,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rose</span> <span class="n">stem</span> <span class="o">--</span><span class="n">task</span><span class="o">=</span><span class="nb">all</span> <span class="o">-</span><span class="n">S</span> <span class="n">PREBUILDS</span><span class="o">=</span><span class="n">false</span> <span class="o">-</span><span class="n">S</span> <span class="n">HOUSEKEEPING</span><span class="o">=</span><span class="n">false</span> <span class="o">-</span><span class="n">S</span> <span class="n">USE_EXAB</span><span class="o">=</span><span class="n">true</span> <span class="o">--</span><span class="n">source</span><span class="o">=.</span> <span class="o">--</span><span class="n">source</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">metadata</span><span class="o">/</span><span class="n">working_copy</span>
<span class="n">cylc</span> <span class="n">play</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">suite</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Before continuing the next step you should make sure the suite has run as expected. All tests should pass apart from any tasks that output netcdf (these have _nc in the tasks name) and the SCM tasks. Both of these encode the UM version and use a direct comparison, it is not as simple to exclude UM version from the comparison as we did with tests that use mule-cumf.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Check the test results by running something like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">find</span> <span class="o">~</span><span class="n">cylc</span><span class="o">-</span><span class="n">run</span><span class="o">/&lt;</span><span class="n">suite</span> <span class="n">name</span><span class="o">&gt;/</span><span class="n">runN</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">job</span> <span class="o">-</span><span class="n">path</span> <span class="s2">&quot;*rose_ana*&quot;</span> <span class="o">-</span><span class="nb">type</span> <span class="n">f</span> <span class="o">-</span><span class="n">name</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span> <span class="o">|</span> <span class="n">xargs</span> <span class="n">grep</span> <span class="o">-</span><span class="n">l</span> <span class="n">CYLC_JOB_EXIT</span><span class="o">=</span><span class="n">ERR</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">vE</span> <span class="s2">&quot;(scm|netcdf)&quot;</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">meto_update_kgo.sh</span></code> script is stored in SimSys_Scripts. As yourself, navigate to <code class="docutils literal notranslate"><span class="pre">$UMDIR/SimSys_Scripts/kgo_updates</span></code> directory and run <code class="docutils literal notranslate"><span class="pre">./meto_update_kgo.sh</span> <span class="pre">--new-release</span></code> and follow its instructions.</p>
<ul class="simple">
<li><p>First it will ask for all platforms run on, <code class="docutils literal notranslate"><span class="pre">azspice</span> <span class="pre">ex1a</span></code></p></li>
<li><p>It will ask which Host Zone the tests ran on - we specified EXAB so choose that (Host Zone 1).</p></li>
<li><p>You will need to supply the username and suitename of the suite you ran above. This will need to include the <code class="docutils literal notranslate"><span class="pre">runX</span></code> directory.</p></li>
<li><p>The version number should be the new version.</p></li>
<li><p>The ticket number won’t be used but can be entered as the ticket associated with the release.</p></li>
<li><p>When asked how the new kgo directory should be named overwrite the default with the name <code class="docutils literal notranslate"><span class="pre">vnX.Y</span></code> where this is the new version number.</p></li>
<li><p>It will show you the settings to double check before you continue.</p>
<ul>
<li><p>Pay particular attention to the preview of the list of commands the script will present you with to ensure it has accounted for all expected KGO files.</p></li>
</ul>
</li>
<li><p>The script will install the new kgo on every platform in order azspice-&gt;ex1a. Once these are finished installing it will rsync to the EXCD and EXZ. To install the entire kgo database will take some time.</p></li>
</ul>
<p>Once you believe you have installed the KGO you should fcm revert the changes you made to the variables*.cylc files to reset the KGO variables, <code class="docutils literal notranslate"><span class="pre">fcm</span> <span class="pre">revert</span> <span class="pre">rose-stem/site/meto/variables*</span></code></p>
<p>The test suite should now be rerun to confirm the kgo has been installed properly. As we can’t restart Cylc8 rose-stem suites, the entire thing needs to be rerun. We’re just checking that the kgo has been installed, so it’s probably unnecessary to wait for the entire thing - instead just ensure a reasonable range of rose-ana tasks have passed.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Has the ability to reload the test suite been enabled yet? If so <code class="docutils literal notranslate"><span class="pre">cylc</span> <span class="pre">vr</span></code> can likely be used to restart the original suite. These instructions also need updating!</p>
</div>
</section>
<section id="review-and-commit">
<h2>Review and Commit<a class="headerlink" href="#review-and-commit" title="Permalink to this heading">#</a></h2>
<p>Ensure all changes are committed to both branches and then pass along for a review to someone in the team.</p>
<p>Notes for Reviewer:</p>
<ul class="simple">
<li><p>In <code class="docutils literal notranslate"><span class="pre">rose-stem/site/meto/variables</span></code>, ensure the <code class="docutils literal notranslate"><span class="pre">PREBUILDS</span></code> variable near the top is set to true.</p></li>
<li><p>Once happy, commit both the meta and main branches, and return the ticket to the developer.</p></li>
</ul>
<p>Now <a class="reference internal" href="../curaterelease.html#reference-tagging"><span class="std std-ref">tag</span></a> the trunk with the <code class="docutils literal notranslate"><span class="pre">vnX.Y</span> <span class="pre">=</span> <span class="pre">RRR</span></code> tag.</p>
<p><strong>Now make sure to revert changes to ``~/.metomi/fcm/keyword.cfg`` on all platforms</strong></p>
</section>
<section id="install-the-release">
<h2>Install the Release<a class="headerlink" href="#install-the-release" title="Permalink to this heading">#</a></h2>
<p>The main installation of ctldata, utilities and prebuilds can now take place. This all takes place as the <code class="docutils literal notranslate"><span class="pre">umadmin</span></code> account so log in to that now.</p>
<p>Delete any remaining temporary vnX.Y keywords for umadmin/umtest, on <strong>all</strong> platforms. Check all keyword.cfg files, and do both accounts now. They could be left over from the earlier test build, even if you didn’t set them.</p>
<p>Check out the UM trunk into a working copy. <code class="docutils literal notranslate"><span class="pre">umadmin</span></code> can only check out from the mirror.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fcm</span> <span class="n">co</span> <span class="n">fcm</span><span class="p">:</span><span class="n">um</span><span class="o">.</span><span class="n">xm_tr</span><span class="nd">@vnX</span><span class="o">.</span><span class="n">Y</span> <span class="n">umX</span><span class="o">.</span><span class="n">Y_install</span>
<span class="n">cd</span> <span class="n">umX</span><span class="o">.</span><span class="n">Y_install</span>
</pre></div>
</div>
<p>First check that the upgrade has gone successfully and the new install will appear in the correct place. Do this by running,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rose</span> <span class="n">stem</span> <span class="o">--</span><span class="n">group</span><span class="o">=</span><span class="n">install</span> <span class="o">-</span><span class="n">S</span> <span class="n">CENTRAL_INSTALL</span><span class="o">=</span><span class="n">false</span> <span class="o">-</span><span class="n">S</span> <span class="n">PREBUILDS</span><span class="o">=</span><span class="n">false</span> <span class="o">-</span><span class="n">S</span> <span class="n">USE_EXAB</span><span class="o">=</span><span class="n">true</span>
<span class="n">cylc</span> <span class="n">play</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">suite</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>and check that <code class="docutils literal notranslate"><span class="pre">~umadmin/cylc_run/&lt;working_copy_name&gt;/runN/share/vnX.Y</span></code> exists and is the new version number. If that has worked, change the CENTRALL_INSTALL flag to true and rerun,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rose</span> <span class="n">stem</span> <span class="o">--</span><span class="n">group</span><span class="o">=</span><span class="n">install</span> <span class="o">-</span><span class="n">S</span> <span class="n">CENTRAL_INSTALL</span><span class="o">=</span><span class="n">true</span> <span class="o">-</span><span class="n">S</span> <span class="n">PREBUILDS</span><span class="o">=</span><span class="n">false</span> <span class="o">-</span><span class="n">S</span> <span class="n">USE_EXAB</span><span class="o">=</span><span class="n">true</span>
<span class="n">cylc</span> <span class="n">play</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">suite</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Next, rerun the install for the 2nd host zone,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rose</span> <span class="n">stem</span> <span class="o">--</span><span class="n">group</span><span class="o">=</span><span class="n">ex1a_install</span> <span class="o">-</span><span class="n">S</span> <span class="n">CENTRAL_INSTALL</span><span class="o">=</span><span class="n">true</span> <span class="o">-</span><span class="n">S</span> <span class="n">PREBUILDS</span><span class="o">=</span><span class="n">false</span> <span class="o">-</span><span class="n">S</span> <span class="n">USE_EXCD</span><span class="o">=</span><span class="n">true</span>
<span class="n">cylc</span> <span class="n">play</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">suite</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Finally, rerun the install for the EXZ,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rose</span> <span class="n">stem</span> <span class="o">--</span><span class="n">group</span><span class="o">=</span><span class="n">ex1a_install</span> <span class="o">-</span><span class="n">S</span> <span class="n">CENTRAL_INSTALL</span><span class="o">=</span><span class="n">true</span> <span class="o">-</span><span class="n">S</span> <span class="n">PREBUILDS</span><span class="o">=</span><span class="n">false</span> <span class="o">-</span><span class="n">S</span> <span class="n">USE_EXZ</span><span class="o">=</span><span class="n">true</span>
<span class="n">cylc</span> <span class="n">play</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">suite</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The release is now installed and can be announced.</p>
</section>
<section id="make-release-prebuilds">
<h2>Make Release Prebuilds<a class="headerlink" href="#make-release-prebuilds" title="Permalink to this heading">#</a></h2>
<p>Now it is time to install the prebuilds.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Use Cylc 7 (<code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">CYLC_VERSION=7</span></code>) to install the prebuilds. It is important to set the source to the UM fcm mirror in the commands below, and use the config option to point at the rose-stem directory. If this wasn’t done, prebuild availability would depend on the host machine you are currently on being available. rose-stem in cylc8 doesn’t support this, hence using cylc7.</p>
<p>A fix for this will likely become available with the move to git. The timescales for that are shorter than for removing Cylc7.</p>
</div>
<p>First install the prebuilds on Azure Spice and EXAB,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">CYLC_VERSION</span><span class="o">=</span><span class="mi">7</span>
<span class="n">rose</span> <span class="n">stem</span> <span class="o">--</span><span class="n">group</span><span class="o">=</span><span class="n">prebuilds</span> <span class="o">--</span><span class="n">source</span><span class="o">=</span><span class="n">fcm</span><span class="p">:</span><span class="n">um</span><span class="o">.</span><span class="n">xm_tr</span><span class="nd">@vnX</span><span class="o">.</span><span class="n">Y</span> <span class="o">--</span><span class="n">name</span><span class="o">=</span><span class="n">vnX</span><span class="o">.</span><span class="n">Y_prebuilds</span> <span class="o">--</span><span class="n">config</span><span class="o">=./</span><span class="n">rose</span><span class="o">-</span><span class="n">stem</span> <span class="o">-</span><span class="n">S</span> <span class="n">MAKE_PREBUILDS</span><span class="o">=</span><span class="n">true</span> <span class="o">-</span><span class="n">S</span> <span class="n">USE_EXAB</span><span class="o">=</span><span class="n">true</span>
</pre></div>
</div>
<p>And then on the EXCD - make sure to <strong>not</strong> use <code class="docutils literal notranslate"><span class="pre">--new</span></code> in this command or the previous set will have been overwritten.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">CYLC_VERSION</span><span class="o">=</span><span class="mi">7</span>
<span class="n">rose</span> <span class="n">stem</span> <span class="o">--</span><span class="n">group</span><span class="o">=</span><span class="n">ex1a_fcm_make</span><span class="p">,</span><span class="n">ex1a_fcm_make_portio2b</span> <span class="o">--</span><span class="n">source</span><span class="o">=</span><span class="n">fcm</span><span class="p">:</span><span class="n">um</span><span class="o">.</span><span class="n">xm_tr</span><span class="nd">@vnX</span><span class="o">.</span><span class="n">Y</span> <span class="o">--</span><span class="n">name</span><span class="o">=</span><span class="n">vnX</span><span class="o">.</span><span class="n">Y_prebuilds</span> <span class="o">--</span><span class="n">config</span><span class="o">=./</span><span class="n">rose</span><span class="o">-</span><span class="n">stem</span> <span class="o">-</span><span class="n">S</span> <span class="n">MAKE_PREBUILDS</span><span class="o">=</span><span class="n">true</span> <span class="o">-</span><span class="n">S</span> <span class="n">USE_EXCD</span><span class="o">=</span><span class="n">true</span>
</pre></div>
</div>
<p>And finally on the EXZ - make sure to <strong>not</strong> use <code class="docutils literal notranslate"><span class="pre">--new</span></code> in this command or the previous set will have been overwritten.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">CYLC_VERSION</span><span class="o">=</span><span class="mi">7</span>
<span class="n">rose</span> <span class="n">stem</span> <span class="o">--</span><span class="n">group</span><span class="o">=</span><span class="n">ex1a_fcm_make</span><span class="p">,</span><span class="n">ex1a_fcm_make_portio2b</span> <span class="o">--</span><span class="n">source</span><span class="o">=</span><span class="n">fcm</span><span class="p">:</span><span class="n">um</span><span class="o">.</span><span class="n">xm_tr</span><span class="nd">@vnX</span><span class="o">.</span><span class="n">Y</span> <span class="o">--</span><span class="n">name</span><span class="o">=</span><span class="n">vnX</span><span class="o">.</span><span class="n">Y_prebuilds</span> <span class="o">--</span><span class="n">config</span><span class="o">=./</span><span class="n">rose</span><span class="o">-</span><span class="n">stem</span> <span class="o">-</span><span class="n">S</span> <span class="n">MAKE_PREBUILDS</span><span class="o">=</span><span class="n">true</span> <span class="o">-</span><span class="n">S</span> <span class="n">USE_EXZ</span><span class="o">=</span><span class="n">true</span>
</pre></div>
</div>
</section>
<section id="monsoon-installation">
<h2>Monsoon Installation<a class="headerlink" href="#monsoon-installation" title="Permalink to this heading">#</a></h2>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This section can be done in parallel with the previous one</p>
</div>
<p>We also install the UM onto Monsoon - to do this you will need a Monsoon account with access to the <code class="docutils literal notranslate"><span class="pre">umadmin.mon</span></code> shared account.</p>
<p>First, log into Monsoon as <code class="docutils literal notranslate"><span class="pre">umadmin.mon</span></code> and then check out the trunk at the new version just released.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fcm</span> <span class="n">co</span> <span class="n">fcm</span><span class="p">:</span><span class="n">um</span><span class="o">.</span><span class="n">xm_tr</span><span class="nd">@vnXX</span><span class="o">.</span><span class="n">Y</span>
</pre></div>
</div>
<p>Next, symlink the input data as was done for other platforms,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mv</span> <span class="n">vn11</span><span class="mf">.5</span> <span class="n">vn11</span><span class="mf">.6</span><span class="p">;</span> <span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="n">vn11</span><span class="mf">.6</span> <span class="n">vn11</span><span class="mf">.5</span>
</pre></div>
</div>
<p>Now run the central install group,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rose</span> <span class="n">stem</span> <span class="o">--</span><span class="n">group</span><span class="o">=</span><span class="n">ex1a_install</span> <span class="o">-</span><span class="n">S</span> <span class="n">CENTRAL_INSTALL</span><span class="o">=</span><span class="n">true</span> <span class="o">-</span><span class="n">S</span> <span class="n">PREBUILDS</span><span class="o">=</span><span class="n">false</span>
<span class="n">cylc</span> <span class="n">play</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">suite</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Install prebuilds on Monsoon. Note the <code class="docutils literal notranslate"><span class="pre">--no-run-name</span></code> is required to force the install location to be consistent with other platforms.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rose</span> <span class="n">stem</span> <span class="o">--</span><span class="n">group</span><span class="o">=</span><span class="n">ex1a_fcm_make</span><span class="p">,</span><span class="n">ex1a_fcm_make_portio2b</span> <span class="o">-</span><span class="n">S</span> <span class="n">MAKE_PREBUILDS</span><span class="o">=</span><span class="n">true</span> <span class="o">-</span><span class="n">n</span> <span class="n">vnX</span><span class="o">.</span><span class="n">Y_prebuilds</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">run</span><span class="o">-</span><span class="n">name</span>
<span class="n">cylc</span> <span class="n">play</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">suite</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Finally we need to install the kgo for the release. Do this by running the <code class="docutils literal notranslate"><span class="pre">ex1a</span></code> group. Once that is finished, run the kgo install script (sourced from the SimSys_Scripts repo).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rose</span> <span class="n">stem</span> <span class="o">--</span><span class="n">group</span><span class="o">=</span><span class="n">ex1a</span>
<span class="n">cylc</span> <span class="n">play</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">-</span><span class="n">of</span><span class="o">-</span><span class="n">suite</span><span class="o">&gt;</span>
<span class="c1"># Wait for tests to complete</span>
<span class="n">python3</span> <span class="n">SimSys_Scripts</span><span class="o">/</span><span class="n">kgo_updates</span><span class="o">/</span><span class="n">kgo_update</span><span class="o">/</span><span class="n">kgo_update</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">N</span> <span class="n">vnX</span><span class="o">.</span><span class="n">Y</span> <span class="o">-</span><span class="n">P</span> <span class="n">ex1a</span> <span class="o">--</span><span class="n">new</span><span class="o">-</span><span class="n">release</span> <span class="o">--</span><span class="n">non</span><span class="o">-</span><span class="n">interactive</span>
</pre></div>
</div>
<p>Check that the kgo has been installed in place correctly at <code class="docutils literal notranslate"><span class="pre">$UMDIR/standard_jobs/kgo</span></code>.</p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="mule_release.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Mule Release</p>
      </div>
    </a>
    <a class="right-next"
       href="lfric_apps_release.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">LFRic Apps Release</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-ticket-and-create-branches">Create a ticket and Create Branches</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tagging-feeder-trunks">Tagging Feeder Trunks</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#apply-code-styling">Apply Code Styling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-metadata-and-rose-apps">Checking Metadata and Rose Apps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-release-script">Running the Release Script</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#copying-the-metadata-and-upgrade-macros-to-the-um-meta-branch">Copying the metadata and upgrade macros to the um_meta branch</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#final-checks">Final Checks</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparing-to-test">Preparing to Test</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-and-kgo-generation">Testing and KGO Generation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#review-and-commit">Review and Commit</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#install-the-release">Install the Release</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#make-release-prebuilds">Make Release Prebuilds</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#monsoon-installation">Monsoon Installation</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

<p class="copyright">
    
    © Crown Copyright, Met Office 2023.
    <br/>
    
</p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.2.1.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>