<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rose Stem Suite &mdash; Simulation Systems  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/design-tabs.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Testing Your Change" href="testing.html" />
    <link rel="prev" title="LFRic Diagnostics" href="Diagnostics/lfric_diagnostics.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Simulation Systems
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Working Practices</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="working_practices.html">About the Working Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="planning_your_change.html">Planning Your Change</a></li>
<li class="toctree-l1"><a class="reference internal" href="tickets.html">Create a ticket</a></li>
<li class="toctree-l1"><a class="reference internal" href="branches.html">Create a branch</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="developing_change.html">Developing Your Change</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="documentation.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="inputs.html">Input Variables, Rose Metadata and Upgrade Macros</a></li>
<li class="toctree-l2"><a class="reference internal" href="kgo.html">Known Good Output (KGO)</a></li>
<li class="toctree-l2"><a class="reference internal" href="diagnostics.html">Diagnostic Systems</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Rose Stem Suite</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#adding-a-new-app">Adding a new app</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing Your Change</a></li>
<li class="toctree-l1"><a class="reference internal" href="multi_repository.html">Working with Multiple Repositories</a></li>
<li class="toctree-l1"><a class="reference internal" href="approvals.html">Approval Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="reviews.html">Reviews</a></li>
<li class="toctree-l1"><a class="reference internal" href="final_steps.html">Final Steps</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Guides for Reviewers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Reviewers/scitechreview.html">Science and Technical Review</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Reviewers/codereview.html">Code and System Review</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Reviewers/howtocommit.html">How To Commit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Reviewers/curaterelease.html">Curating a Release</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Further Details</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="who.html">Who’s Who</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Simulation Systems Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="code_of_conduct.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="dos_donts.html">Do’s and Don’ts</a></li>
<li class="toctree-l1"><a class="reference internal" href="change_notes.html">Recent Changes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Simulation Systems</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="developing_change.html">Developing Your Change</a></li>
      <li class="breadcrumb-item active">Rose Stem Suite</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/WorkingPractices/rose_stem.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="rose-stem-suite">
<h1>Rose Stem Suite<a class="headerlink" href="#rose-stem-suite" title="Permalink to this heading"></a></h1>
<p>All new changes are strongly encouraged to come with an update to the
rose stem suite to protect any new functionality. Configuration owners may also
wish to update the suite to ensure that important configurations are protected
by the rose stem suite.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you find that you need to update all the apps in the rose stem suite
to get your change to work then you should use an upgrade macro. See
<a class="reference internal" href="inputs.html#inputs"><span class="std std-ref">Input Variables, Rose Metadata and Upgrade Macros</span></a>.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Familiarise yourself with the <a class="reference external" href="https://metomi.github.io/rose/doc/html/tutorial/rose/furthertopics/rose-stem.html#">Rose documentation</a>
before continuing with this section.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Migration to cylc8 and rose2 is currently in progress. UM, JULES and UKCA suites will
work with the latest versions as well as cylc7. The LFRic Apps rose-stem
has been written for cylc8 and is not backwards compatible.</p>
</div>
<section id="adding-a-new-app">
<h2>Adding a new app<a class="headerlink" href="#adding-a-new-app" title="Permalink to this heading"></a></h2>
<p>Adding a new app to rose-stem can look daunting, but is actually less difficult
than many other development processes as there are many examples to reference
already in the code.</p>
<ol class="arabic">
<li><p>rose-stem/app/</p>
<blockquote>
<div><p>Start by creating a new app with the details of the test you wish to run.
This might be an optional configuration for an existing app, or something
completely new.</p>
<p>For the UM also create a matching rose-ana app detailing the comparisons
required.</p>
<p>Both of these will be easiest to copy an existing app that is similar to what
you are creating and modify from there. You can use the rose edit gui or
manually modify the rose-app.conf files.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The app should validate (i.e. be consistent with the Rose metadata, and
produce no warnings or errors). This can be checked by running <code class="docutils literal notranslate"><span class="pre">rose</span> <span class="pre">macro</span>
<span class="pre">--validate</span> <span class="pre">--no-warn</span> <span class="pre">version</span> <span class="pre">-M</span> <span class="pre">path/to/rose-meta</span></code> from within your new
app directory, or selecting Metadata -&gt; Check fail-if, warn-if from the
drop-down menu of the rose edit gui.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>If you are working in a UM branch and have <strong>jules-shared</strong>
changes, the JULES metadata path will also need
adding. Please see the shared metadata
<a class="reference internal" href="metadata_guidance.html#shared-namelists"><span class="std std-ref">guidance</span></a>.</p>
</div>
</div>
</div></blockquote>
</li>
</ol>
<p>The next steps are site and rose-stem specific, but fall broadly into two
categories - those using a jinja2 templated design which populate runtime and graph
sections for you, such as the UM METO suite, and those which are manually configured,
such as JULES.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-0" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-0">
Templated</label><div class="sd-tab-content docutils">
<ol class="arabic" start="2">
<li><p>Task definitions</p>
<blockquote>
<div><p>Task definitions should be added to the tasks.rc for all sites who
will run this app.</p>
<p>The tasks are defined in a dictionary format, with one entry per
configuration and all other details are handled by the templates.
It is possible to define multiple decomposition and thread
options in this single entry and comparison details are also defined
within that same dictionary entry.</p>
<p>Details of the available options are listed in the template files
in <code class="docutils literal notranslate"><span class="pre">rose-stem/templates</span></code> for each suite and looking at existing examples
is encouraged.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>LFRic Apps has a <a class="reference external" href="https://code.metoffice.gov.uk/trac/lfric_apps/wiki/rose-stem">detailed set of wiki pages</a>
that document the structure and options available for their suite.</p>
</div>
</div></blockquote>
</li>
</ol>
</div>
<input id="sd-tab-item-1" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-1">
Manual</label><div class="sd-tab-content docutils">
<ol class="arabic" start="2">
<li><p>Task definitions</p>
<blockquote>
<div><p>Task definitions for the following tasks should be added to the
runtime.rc for all sites who will run this app.</p>
<blockquote>
<div><ul class="simple">
<li><p>run the app</p></li>
<li><p>perform a KGO comparison</p></li>
<li><p>perform housekeeping</p></li>
</ul>
</div></blockquote>
</div></blockquote>
</li>
<li><p>Graph definitions</p>
<blockquote>
<div><p>Graph definitions should be added to the graph.rc for all sites who
will run this app. These should connect together your new tasks
created above with an appropriate build task.</p>
</div></blockquote>
</li>
</ol>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<dl class="simple">
<dt>The site specific information is held in:</dt><dd><ul class="simple">
<li><p>JULES: rose-stem/include</p></li>
<li><p>LFRic Apps &amp; UM: rose-stem/site</p></li>
</ul>
</dd>
</dl>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>All <cite>*.rc</cite> or <cite>.cylc</cite> files mentioned are frequently split into platform
specific variants depending on the complexity of the sites suite.</p>
<p>e.g. <cite>runtime.rc</cite> may be spread across <cite>runtime-platform1.rc</cite> and <cite>runtime-platform2.rc</cite>.
If a task should be run on both platform1 and platform2 then both of these
will need the task definition adding.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Diagnostics/lfric_diagnostics.html" class="btn btn-neutral float-left" title="LFRic Diagnostics" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="testing.html" class="btn btn-neutral float-right" title="Testing Your Change" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023-2024, Simulation Systems and Deployment Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>